 æˆ‘å°†åŸºäºå‘¨éœ‡çš„ä»»åŠ¡ä¹¦ï¼ˆåŸºäºå¾®ä¿¡å°ç¨‹åºçš„æ ¡å›­æœåŠ¡æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼‰å’Œå·²æœ‰çš„5æ–‡æ¡£ä½“ç³»ï¼Œä¸ºæ‚¨æ’°å†™å®Œæ•´çš„ã€æ–‡æ¡£4ï¼šç¼–ç è§„èŒƒä¸å®ç°æ¨¡æ¿ã€‘ã€‚

---

# æ–‡æ¡£4ï¼šç¼–ç è§„èŒƒä¸å®ç°æ¨¡æ¿

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**ç¼–å†™æ—¥æœŸ**ï¼š2026å¹´2æœˆ19æ—¥  
**ç¼–å†™äºº**ï¼šå‘¨éœ‡  
**æŒ‡å¯¼æ•™å¸ˆ**ï¼šé‚“å¨œ/å¼ é™ˆæ™¨  
**æ‰€å±é™¢ç³»**ï¼šè®¡ç®—æœºç³» 24gbsè®¡ç®—ä¸€ç­  
**æŠ€æœ¯æ ˆ**ï¼šå¾®ä¿¡å°ç¨‹åºåŸç”Ÿï¼ˆWXML/WXSS/JSï¼‰+ Vue 3 + Element UI + SpringBoot 2.7.x + MyBatis-Plus + MySQL 8.0 + Jiebaåˆ†è¯

---

## ä½¿ç”¨è¯´æ˜

```
ã€æœ¬æ–‡æ¡£å®šä½ã€‘ç¼–ç é˜¶æ®µçš„"å­—å…¸+æ¨¡æ¿+é˜²é”™æ¸…å•"
ã€ä½¿ç”¨æ–¹å¼ã€‘
  1. ç¯å¢ƒæ­å»º â†’ æŒ‰ç¬¬1ç« é€é¡¹æ£€æŸ¥
  2. å†™åç«¯ä»£ç  â†’ å¤åˆ¶ç¬¬2ç« Javaæ¨¡æ¿ï¼Œéµå®ˆç¼–ç è§„èŒƒ
  3. å†™å¾®ä¿¡å°ç¨‹åº â†’ å¤åˆ¶ç¬¬3ç« WXML/WXSS/JSæ¨¡æ¿
  4. å†™ç®¡ç†åå° â†’ å¤åˆ¶ç¬¬4ç« Vue3æ¨¡æ¿
  5. æäº¤å‰ â†’ æ‰“å‹¾ç¬¬5ç« æ£€æŸ¥æ¸…å•

ã€ä¸5æ–‡æ¡£ä½“ç³»å…³ç³»ã€‘
  æœ¬æ–‡æ¡£ â† è¾“å…¥ï¼šæ–‡æ¡£1ï¼ˆæ¶æ„å†³ç­–ï¼‰ã€æ–‡æ¡£2ï¼ˆæ•°æ®æ¨¡å‹ï¼‰ã€æ–‡æ¡£3ï¼ˆAPIå¥‘çº¦ï¼‰
  æœ¬æ–‡æ¡£ â†’ è¾“å‡ºï¼šå¯è¿è¡Œçš„ä»£ç æ¨¡æ¿ã€æ£€æŸ¥æ¸…å•
  æœ¬æ–‡æ¡£ â†’ æŒ‡å¯¼ï¼šæ–‡æ¡£5ï¼ˆéªŒæ”¶çº¢çº¿ï¼‰
```

---

## ç¬¬1ç«  ç¯å¢ƒé…ç½®ï¼ˆ5åˆ†é’Ÿå¯åŠ¨æ£€æŸ¥ï¼‰

### 1.1 ç‰ˆæœ¬é”å®šæ¸…å•ï¼ˆå¼ºåˆ¶åŒ¹é…ï¼‰

| ç»„ä»¶           | ç‰ˆæœ¬è¦æ±‚                    | æ£€æŸ¥å‘½ä»¤          | ä¸ç¬¦åæœ                     |
| :------------- | :-------------------------- | :---------------- | :--------------------------- |
| å¾®ä¿¡å¼€å‘è€…å·¥å…· | ç¨³å®šç‰ˆæœ€æ–°ï¼ˆv1.06+ï¼‰        | å…³äºé¡µé¢          | äº‘å¼€å‘åŠŸèƒ½ä¸å…¼å®¹ï¼Œè°ƒè¯•å™¨å´©æºƒ |
| Node.js        | 18.x LTS                    | `node -v`         | Vue3/Vite5æ— æ³•å¯åŠ¨           |
| Java           | 17 LTS                      | `java -version`   | SpringBoot 2.7.xè¦æ±‚         |
| Maven          | 3.8.x+                      | `mvn -v`          | ä¾èµ–è§£æå¤±è´¥                 |
| MySQL          | 8.0.x                       | `mysql --version` | å…¨æ–‡ç´¢å¼•åŠŸèƒ½å·®å¼‚             |
| Redis          | 7.0.xï¼ˆå¯é€‰ï¼Œç¼“å­˜çƒ­ç‚¹é—®é¢˜ï¼‰ | `redis-cli ping`  | ç¼“å­˜åŠŸèƒ½ç¼ºå¤±                 |
| IntelliJ IDEA  | 2023.x+                     | å…³äºé¡µé¢          | æ–°ç‰¹æ€§æ”¯æŒ                   |

### 1.2 ç«¯å£åˆ†é…è¡¨ï¼ˆé˜²å†²çªï¼‰

| æœåŠ¡           | ç«¯å£       | å ç”¨æ£€æŸ¥å‘½ä»¤                   | å¼ºåˆ¶é‡Šæ”¾å‘½ä»¤             |
| :------------- | :--------- | :----------------------------- | :----------------------- |
| MySQL          | 3306       | `netstat -ano \| findstr 3306` | `taskkill /PID <PID> /F` |
| Redis          | 6379       | `netstat -ano \| findstr 6379` | `redis-cli shutdown`     |
| SpringBootåç«¯ | 8080       | `netstat -ano \| findstr 8080` | é‡å¯IDEAæˆ–æ”¹é…ç½®         |
| Vueç®¡ç†ç«¯      | 5173       | `netstat -ano \| findstr 5173` | è‡ªåŠ¨é€’å¢                 |
| å¾®ä¿¡å¼€å‘è€…å·¥å…· | ç«¯å£å·åŠ¨æ€ | å·¥å…·è®¾ç½®æŸ¥çœ‹                   | é‡å¯å·¥å…·                 |

**PowerShellä¸€é”®æ£€æŸ¥è„šæœ¬**ï¼ˆ`check-env.ps1`ï¼‰ï¼š
```powershell
Write-Host "=== æ ¡å›­æ™ºèƒ½é—®ç­”ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥ ===" -ForegroundColor Green
$ports = @(3306, 6379, 8080, 5173)
foreach ($port in $ports) {
    $result = netstat -ano | findstr $port
    if ($result) {
        Write-Host "ç«¯å£ $port è¢«å ç”¨ï¼š" -ForegroundColor Yellow
        $result | ForEach-Object { Write-Host "  $_" }
    } else {
        Write-Host "ç«¯å£ $port ç©ºé—² âœ…" -ForegroundColor Green
    }
}

Write-Host "`n=== ç‰ˆæœ¬æ£€æŸ¥ ===" -ForegroundColor Green
node -v
java -version
mvn -v
mysql --version

Write-Host "`n=== å¾®ä¿¡å¼€å‘è€…å·¥å…· ===" -ForegroundColor Green
Write-Host "è¯·æ‰‹åŠ¨ç¡®è®¤ï¼šå·¥å…· â†’ å…³äº â†’ ç‰ˆæœ¬ â‰¥ v1.06"
```

### 1.3 é¡¹ç›®ç»“æ„æ€»è§ˆ

```
campus-qa-system/
â”œâ”€â”€ ğŸ“± å¾®ä¿¡å°ç¨‹åºç«¯ï¼ˆåŸç”Ÿï¼‰
â”‚   â””â”€â”€ campus-qa-miniapp/
â”‚       â”œâ”€â”€ app.js                 # å…¨å±€é€»è¾‘ï¼ˆç™»å½•æ€ç®¡ç†ï¼‰
â”‚       â”œâ”€â”€ app.json               # å…¨å±€é…ç½®ï¼ˆé¡µé¢è·¯ç”±ã€tabBarï¼‰
â”‚       â”œâ”€â”€ app.wxss               # å…¨å±€æ ·å¼ï¼ˆCSSå˜é‡ï¼‰
â”‚       â”œâ”€â”€ pages/
â”‚       â”‚   â”œâ”€â”€ index/             # é¦–é¡µï¼ˆæœç´¢å…¥å£+çƒ­é—¨é—®é¢˜ï¼‰
â”‚       â”‚   â”œâ”€â”€ search/            # æœç´¢ç»“æœé¡µï¼ˆåˆ†ç±»ç­›é€‰+æ’åºï¼‰
â”‚       â”‚   â”œâ”€â”€ qa-detail/         # é—®ç­”è¯¦æƒ…é¡µï¼ˆå¯Œæ–‡æœ¬æ¸²æŸ“ï¼‰
â”‚       â”‚   â”œâ”€â”€ notice/            # é€šçŸ¥å…¬å‘Šé¡µï¼ˆè®¢é˜…æ¨é€ï¼‰
â”‚       â”‚   â”œâ”€â”€ guide/             # åŠäº‹æŒ‡å—é¡µï¼ˆæµç¨‹å±•ç¤ºï¼‰
â”‚       â”‚   â”œâ”€â”€ profile/           # ä¸ªäººä¸­å¿ƒï¼ˆæ”¶è—/å†å²/è®¢é˜…ï¼‰
â”‚       â”‚   â””â”€â”€ login/             # ç™»å½•é¡µï¼ˆå¾®ä¿¡æˆæƒ+å­¦å·ç»‘å®šï¼‰
â”‚       â”œâ”€â”€ components/            # å…¬å…±ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ search-bar/        # æœç´¢æ ï¼ˆå¸¦è”æƒ³æç¤ºï¼‰
â”‚       â”‚   â”œâ”€â”€ category-tree/     # åˆ†ç±»æ ‘ï¼ˆæ•™åŠ¡/å­¦å·¥/åå‹¤ï¼‰
â”‚       â”‚   â”œâ”€â”€ qa-card/           # é—®ç­”å¡ç‰‡ï¼ˆæ ‡é¢˜+æ‘˜è¦+çƒ­åº¦ï¼‰
â”‚       â”‚   â”œâ”€â”€ notice-item/       # é€šçŸ¥é¡¹ï¼ˆç´§æ€¥ç¨‹åº¦æ ‡è¯†ï¼‰
â”‚       â”‚   â””â”€â”€ guide-step/        # åŠäº‹æ­¥éª¤ï¼ˆæµç¨‹æŒ‡å¼•ï¼‰
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ request.js         # è¯·æ±‚å°è£…ï¼ˆTokenè‡ªåŠ¨ç»­æœŸï¼‰
â”‚       â”‚   â”œâ”€â”€ auth.js            # ç™»å½•æ€ç®¡ç†ï¼ˆJWT+å¾®ä¿¡codeï¼‰
â”‚       â”‚   â”œâ”€â”€ format.js          # æ ¼å¼åŒ–å·¥å…·ï¼ˆæ—¶é—´/å¯Œæ–‡æœ¬ï¼‰
â”‚       â”‚   â””â”€â”€ jieba-helper.js    # åˆ†è¯è¾…åŠ©ï¼ˆå‰ç«¯è½»é‡åˆ†è¯ï¼‰
â”‚       â””â”€â”€ services/
â”‚           â”œâ”€â”€ userService.js     # ç”¨æˆ·æœåŠ¡ï¼ˆç™»å½•/ç»‘å®š/ä¿¡æ¯ï¼‰
â”‚           â”œâ”€â”€ qaService.js       # é—®ç­”æœåŠ¡ï¼ˆæœç´¢/è¯¦æƒ…/åé¦ˆï¼‰
â”‚           â”œâ”€â”€ noticeService.js   # é€šçŸ¥æœåŠ¡ï¼ˆåˆ—è¡¨/è®¢é˜…/æ¨é€ï¼‰
â”‚           â””â”€â”€ guideService.js    # æŒ‡å—æœåŠ¡ï¼ˆåˆ†ç±»/è¯¦æƒ…ï¼‰
â”‚
â”œâ”€â”€ ğŸ’» ç®¡ç†åå°ï¼ˆVue3 + Element UIï¼‰
â”‚   â””â”€â”€ campus-qa-admin/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ views/
â”‚       â”‚   â”‚   â”œâ”€â”€ qa/            # é—®ç­”åº“ç®¡ç†ï¼ˆCRUD+å®¡æ ¸ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ notice/       # é€šçŸ¥ç®¡ç†ï¼ˆå‘å¸ƒ/èŒƒå›´æ§åˆ¶ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ category/     # åˆ†ç±»ç®¡ç†ï¼ˆæ ‘å½¢ç»“æ„ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ user/          # ç”¨æˆ·ç®¡ç†ï¼ˆè§’è‰²/æƒé™ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ feedback/      # åé¦ˆå¤„ç†ï¼ˆè¯„ä»·å›å¤ï¼‰
â”‚       â”‚   â”‚   â””â”€â”€ stats/         # æ•°æ®ç»Ÿè®¡ï¼ˆå¯è§†åŒ–æŠ¥è¡¨ï¼‰
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â”‚   â”œâ”€â”€ RichEditor/    # å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆé€šçŸ¥/é—®ç­”ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ CategoryTree/  # åˆ†ç±»æ ‘é€‰æ‹©å™¨
â”‚       â”‚   â”‚   â””â”€â”€ DataTable/     # ç»Ÿä¸€è¡¨æ ¼ï¼ˆåˆ†é¡µ/ç­›é€‰ï¼‰
â”‚       â”‚   â”œâ”€â”€ stores/
â”‚       â”‚   â”‚   â”œâ”€â”€ user.js        # ç”¨æˆ·çŠ¶æ€ï¼ˆPiniaï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ qa.js          # é—®ç­”çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ notice.js      # é€šçŸ¥çŠ¶æ€
â”‚       â”‚   â”œâ”€â”€ utils/
â”‚       â”‚   â”‚   â”œâ”€â”€ request.js     # Axioså°è£…
â”‚       â”‚   â”‚   â””â”€â”€ permission.js   # æƒé™å·¥å…·
â”‚       â”‚   â””â”€â”€ App.vue
â”‚       â””â”€â”€ package.json
â”‚
â””â”€â”€ âš™ï¸ åç«¯æœåŠ¡ï¼ˆSpringBootï¼‰
    â””â”€â”€ campus-qa-backend/
        â”œâ”€â”€ src/main/java/com/campus/qa/
        â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨ï¼ˆRESTful APIï¼‰
        â”‚   â”œâ”€â”€ service/impl/       # æœåŠ¡å®ç°ï¼ˆJieba+å…¨æ–‡æ£€ç´¢ï¼‰
        â”‚   â”œâ”€â”€ mapper/             # MyBatis-Plusï¼ˆXMLè½¬ä¹‰ï¼ï¼‰
        â”‚   â”œâ”€â”€ entity/             # å®ä½“ç±»ï¼ˆå¯¹åº”æ–‡æ¡£2ï¼‰
        â”‚   â”œâ”€â”€ vo/                 # è§†å›¾å¯¹è±¡ï¼ˆAPIå“åº”ï¼‰
        â”‚   â”œâ”€â”€ dto/                # æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆAPIè¯·æ±‚ï¼‰
        â”‚   â”œâ”€â”€ config/             # é…ç½®ç±»ï¼ˆJWT/å¾®ä¿¡/å…¨æ–‡æ£€ç´¢ï¼‰
        â”‚   â””â”€â”€ utils/              # å·¥å…·ç±»ï¼ˆJieba/Token/æ—¥æœŸï¼‰
        â””â”€â”€ src/main/resources/
            â”œâ”€â”€ mapper/             # XMLæ˜ å°„æ–‡ä»¶ï¼ˆCDATAï¼ï¼‰
            â””â”€â”€ application.yml     # é…ç½®æ–‡ä»¶
```

---

## ç¬¬2ç«  åç«¯ç¼–ç è§„èŒƒï¼ˆJavaï¼‰

### 2.1 MyBatis-Plus XMLè½¬ä¹‰ï¼ˆé˜²WEB-004/005 SAXParseExceptionï¼‰

**é«˜å±åœºæ™¯**ï¼šå…¨æ–‡æ£€ç´¢SQLä¸­ä½¿ç”¨ `<`ã€`>`ã€`&` ç­‰ç¬¦å·

**é”™è¯¯ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰**ï¼š
```xml
<!-- âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ < å¯¼è‡´XMLè§£æå¤±è´¥ -->
<select id="searchByHot" resultType="QaPair">
    SELECT * FROM t_qa_pair 
    WHERE status = 3 
      AND click_count < 100  <!-- æŠ¥é”™ï¼šSAXParseException -->
    ORDER BY click_count DESC
</select>
```

**æ­£ç¡®å†™æ³•ï¼ˆäºŒé€‰ä¸€ï¼‰**ï¼š

**æ–¹æ¡ˆAï¼šXMLå®ä½“è½¬ä¹‰ï¼ˆç®€å•è¡¨è¾¾å¼ï¼‰**
```xml
<!-- âœ… æ­£ç¡®ï¼šä½¿ç”¨ &lt; æ›¿æ¢ < -->
<select id="searchByHot" resultType="QaPair">
    SELECT * FROM t_qa_pair 
    WHERE status = 3 
      AND click_count &lt; 100
    ORDER BY click_count DESC
</select>

<!-- è½¬ä¹‰å¯¹ç…§è¡¨ -->
&lt;   <!-- < å°äºå· -->
&gt;   <!-- > å¤§äºå· -->
&amp;  <!-- & å’Œå· -->
&apos; <!-- ' å•å¼•å· -->
&quot; <!-- " åŒå¼•å· -->
```

**æ–¹æ¡ˆBï¼šCDATAåŒºå—ï¼ˆå¤æ‚SQLï¼Œæ¨èå…¨æ–‡æ£€ç´¢ï¼‰**
```xml
<!-- âœ… æ­£ç¡®ï¼šå…¨æ–‡æ£€ç´¢SQLä½¿ç”¨CDATA -->
<select id="searchFullText" resultType="QaPair">
    <![CDATA[
        SELECT 
            id,
            title,
            content,
            category_id,
            department_id,
            click_count,
            MATCH(title, content) AGAINST(#{keyword} IN BOOLEAN MODE) as relevance_score
        FROM t_qa_pair 
        WHERE status = 3 
          AND MATCH(title, content) AGAINST(#{keyword} IN BOOLEAN MODE)
        ORDER BY relevance_score DESC, click_count DESC
        LIMIT #{offset}, #{limit}
    ]]>
</select>

<!-- å¸¦åˆ†ç±»ç­›é€‰çš„å…¨æ–‡æ£€ç´¢ -->
<select id="searchByCategory" resultType="QaPair">
    <![CDATA[
        SELECT * FROM t_qa_pair 
        WHERE status = 3 
          AND category_id = #{categoryId}
          AND MATCH(title, content) AGAINST(#{keyword} IN BOOLEAN MODE)
        ORDER BY click_count DESC
        LIMIT #{limit}
    ]]>
</select>
```

**å…³é”®è§„åˆ™**ï¼š
1. `<if>` ç­‰åŠ¨æ€æ ‡ç­¾**ä¸èƒ½**æ”¾åœ¨CDATAå†…éƒ¨
2. æ··åˆä½¿ç”¨æ—¶ï¼ŒåŠ¨æ€æ ‡ç­¾æ”¾å¤–é¢ï¼Œçº¯SQLæ¡ä»¶æ”¾CDATAå†…ï¼š

```xml
<!-- âœ… æ­£ç¡®ï¼šæ··åˆä½¿ç”¨ï¼ˆåˆ†ç±»ç­›é€‰åŠ¨æ€ï¼Œå…¨æ–‡æ£€ç´¢å›ºå®šï¼‰ -->
<select id="searchDynamic" resultType="QaPair">
    SELECT * FROM t_qa_pair
    <where>
        status = 3
        <if test="categoryId != null">
            AND category_id = #{categoryId}
        </if>
        <if test="departmentId != null">
            AND department_id = #{departmentId}
        </if>
        <if test="keyword != null and keyword != ''">
            <![CDATA[
                AND MATCH(title, content) AGAINST(#{keyword} IN BOOLEAN MODE)
            ]]>
        </if>
    </where>
    ORDER BY 
        <choose>
            <when test="sortType == 'RELEVANCE'">
                MATCH(title, content) AGAINST(#{keyword} IN BOOLEAN MODE) DESC
            </when>
            <when test="sortType == 'HOT'">
                click_count DESC
            </when>
            <otherwise>
                update_time DESC
            </otherwise>
        </choose>
    LIMIT #{offset}, #{limit}
</select>
```

**æäº¤å‰å¼ºåˆ¶æ£€æŸ¥å‘½ä»¤**ï¼ˆPowerShellï¼‰ï¼š
```powershell
# æ£€æŸ¥æ‰€æœ‰Mapper XMLæ–‡ä»¶
# 1. æ£€æŸ¥å°äºå·ï¼ˆæœªè½¬ä¹‰çš„ï¼‰
rg -n "where.*<[^!]" src/main/resources/mapper/*.xml
rg -n "and.*<[^!]" src/main/resources/mapper/*.xml
rg -n "or.*<[^!]" src/main/resources/mapper/*.xml

# 2. æ£€æŸ¥æœªè½¬ä¹‰çš„ &
rg -n "&[^a]" src/main/resources/mapper/*.xml | rg -v "&amp;"

# æ— è¾“å‡º = æ£€æŸ¥é€šè¿‡ âœ…
# æœ‰è¾“å‡º = å¿…é¡»ä¿®å¤ âŒ
```

### 2.2 æ ¸å¿ƒä»£ç æ¨¡æ¿

#### 2.2.1 é—®ç­”æœåŠ¡ï¼ˆJiebaåˆ†è¯ + å…¨æ–‡æ£€ç´¢ + æ„å›¾è¯†åˆ«ï¼‰

```java
@Service
@Slf4j
public class QaServiceImpl implements QaService {
    
    @Autowired
    private QaPairMapper qaPairMapper;
    
    @Autowired
    private SearchHistoryMapper searchHistoryMapper;
    
    @Autowired
    private JiebaSegmenter jiebaSegmenter;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ™ºèƒ½æœç´¢ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼Œå¯¹åº”ä»»åŠ¡ä¹¦"å¤šæ¨¡å¼æ™ºèƒ½æ£€ç´¢"ï¼‰
     * 1. Jiebaåˆ†è¯æå–å…³é”®è¯
     * 2. ç®€æ˜“æ„å›¾è¯†åˆ«ï¼ˆè¯¾è¡¨/æˆç»©/åœ°ç‚¹ç­‰ï¼‰
     * 3. å…¨æ–‡æ£€ç´¢ + åˆ†ç±»ç­›é€‰
     * 4. ç›¸å…³æ€§æ’åºï¼ˆå…³é”®è¯åŒ¹é…åº¦ + çƒ­åº¦ï¼‰
     */
    @Override
    public QaSearchResultVO search(String query, Long userId, Integer categoryId, Integer departmentId) {
        // 1. Jiebaåˆ†è¯ï¼ˆç²¾ç¡®æ¨¡å¼ï¼‰
        List<SegToken> tokens = jiebaSegmenter.process(query, SegMode.SEARCH);
        List<String> keywords = tokens.stream()
            .map(t -> t.word)
            .filter(w -> w.length() > 1 && !isStopWord(w))
            .distinct()
            .collect(Collectors.toList());
        
        log.info("æœç´¢åˆ†è¯: query={}, keywords={}", query, keywords);
        
        // 2. ç®€æ˜“æ„å›¾è¯†åˆ«ï¼ˆä»»åŠ¡ä¹¦è¦æ±‚ï¼‰
        IntentType intent = recognizeIntent(keywords);
        
        // 3. æ„å»ºå…¨æ–‡æ£€ç´¢å…³é”®è¯
        String searchKeyword = String.join(" ", keywords);
        
        // 4. æ‰§è¡Œæ£€ç´¢ï¼ˆå¸¦ç¼“å­˜ï¼‰
        String cacheKey = String.format("search:%s:%s:%s:%s", 
            DigestUtils.md5Hex(searchKeyword), categoryId, departmentId, intent);
        
        List<QaPair> results = (List<QaPair>) redisTemplate.opsForValue().get(cacheKey);
        if (results == null) {
            results = executeSearch(searchKeyword, categoryId, departmentId, intent);
            redisTemplate.opsForValue().set(cacheKey, results, 5, TimeUnit.MINUTES);
        }
        
        // 5. è®¡ç®—ç›¸å…³æ€§åˆ†æ•°å¹¶æ’åº
        List<QaPairVO> voList = results.stream()
            .map(qa -> {
                QaPairVO vo = convertToVO(qa);
                vo.setRelevanceScore(calculateRelevance(qa, keywords, intent));
                vo.setIntentType(intent.getDesc());
                return vo;
            })
            .sorted(Comparator.comparing(QaPairVO::getRelevanceScore).reversed())
            .limit(20)
            .collect(Collectors.toList());
        
        // 6. å¼‚æ­¥ä¿å­˜æœç´¢å†å²ï¼ˆä»»åŠ¡ä¹¦"ä¸ªäººæ”¶è—ä¸å†å²"ï¼‰
        asyncSaveHistory(userId, query, keywords, intent, voList.size());
        
        // 7. æ›´æ–°çƒ­é—¨æœç´¢ï¼ˆRedis ZSetï¼‰
        updateHotSearch(keywords);
        
        return QaSearchResultVO.builder()
            .query(query)
            .keywords(keywords)
            .intentType(intent)
            .results(voList)
            .totalCount(voList.size())
            .build();
    }
    
    /**
     * ç®€æ˜“æ„å›¾è¯†åˆ«ï¼ˆåŸºäºè§„åˆ™æ¨¡æ¿ï¼Œä»»åŠ¡ä¹¦è¦æ±‚ï¼‰
     * è¯†åˆ«ï¼šæŸ¥è¯¢ã€åŠç†ã€åœ°ç‚¹ã€æ—¶é—´ç­‰æ„å›¾
     */
    private IntentType recognizeIntent(List<String> keywords) {
        Set<String> keywordSet = new HashSet<>(keywords);
        
        // æŸ¥è¯¢ç±»æ„å›¾
        if (containsAny(keywordSet, "è¯¾è¡¨", "æˆç»©", "å­¦åˆ†", "ç»©ç‚¹", "è€ƒè¯•å®‰æ’")) {
            return IntentType.QUERY;
        }
        
        // åŠç†ç±»æ„å›¾
        if (containsAny(keywordSet, "è¡¥åŠ", "ç”³è¯·", "åŠç†", "æŠ¥å", "ç¼´è´¹")) {
            return IntentType.PROCESS;
        }
        
        // åœ°ç‚¹ç±»æ„å›¾
        if (containsAny(keywordSet, "å“ªé‡Œ", "åœ¨å“ª", "ä½ç½®", "åœ°å€", "åŠå…¬å®¤", "çª—å£")) {
            return IntentType.LOCATION;
        }
        
        // æ—¶é—´ç±»æ„å›¾
        if (containsAny(keywordSet, "æ—¶é—´", "å‡ ç‚¹", "ä»€ä¹ˆæ—¶å€™", "æˆªæ­¢æ—¥æœŸ", "æœ‰æ•ˆæœŸ")) {
            return IntentType.TIME;
        }
        
        return IntentType.GENERAL;
    }
    
    /**
     * æ‰§è¡Œæ•°æ®åº“æ£€ç´¢ï¼ˆå¸¦åˆ†ç±»ç­›é€‰ï¼‰
     */
    private List<QaPair> executeSearch(String keyword, Integer categoryId, 
                                        Integer departmentId, IntentType intent) {
        // æ„å›¾å¢å¼ºï¼šåœ°ç‚¹æ„å›¾ä¼˜å…ˆè¿”å›å¸¦åœ°å€ä¿¡æ¯çš„é—®ç­”
        if (intent == IntentType.LOCATION) {
            return qaPairMapper.searchWithLocation(keyword, categoryId, departmentId, 20);
        }
        
        // é»˜è®¤å…¨æ–‡æ£€ç´¢
        if (categoryId != null || departmentId != null) {
            return qaPairMapper.searchByCategory(keyword, categoryId, departmentId, 20);
        }
        return qaPairMapper.searchFullText(keyword, 20);
    }
    
    /**
     * è®¡ç®—ç›¸å…³æ€§åˆ†æ•°ï¼ˆå…³é”®è¯åŒ¹é…åº¦40% + çƒ­åº¦30% + æ—¶æ•ˆæ€§20% + æ„å›¾åŒ¹é…10%ï¼‰
     */
    private double calculateRelevance(QaPair qa, List<String> keywords, IntentType intent) {
        double score = 0.0;
        
        // 1. æ ‡é¢˜åŒ¹é…æƒé‡æ›´é«˜
        long titleMatches = keywords.stream().filter(k -> qa.getTitle().contains(k)).count();
        score += titleMatches * 0.4;
        
        // 2. å†…å®¹åŒ¹é…
        long contentMatches = keywords.stream().filter(k -> qa.getContent().contains(k)).count();
        score += contentMatches * 0.2;
        
        // 3. çƒ­åº¦åŠ æˆï¼ˆç‚¹å‡»ç‡ï¼‰
        score += Math.log(qa.getClickCount() + 1) * 0.3;
        
        // 4. æ—¶æ•ˆæ€§ï¼ˆè¶Šæ–°è¶Šå¥½ï¼‰
        long daysSinceUpdate = ChronoUnit.DAYS.between(qa.getUpdateTime(), LocalDateTime.now());
        score += Math.max(0, (30 - daysSinceUpdate) / 30.0) * 0.1;
        
        return score;
    }
    
    /**
     * å¼‚æ­¥ä¿å­˜æœç´¢å†å²
     */
    @Async
    public void asyncSaveHistory(Long userId, String query, List<String> keywords, 
                                IntentType intent, int resultCount) {
        SearchHistory history = new SearchHistory();
        history.setUserId(userId);
        history.setQuery(query);
        history.setKeywords(String.join(",", keywords));
        history.setIntentType(intent.name());
        history.setResultCount(resultCount);
        history.setCreateTime(LocalDateTime.now());
        searchHistoryMapper.insert(history);
    }
    
    private boolean isStopWord(String word) {
        // åœç”¨è¯åˆ—è¡¨ï¼šçš„ã€äº†ã€æ˜¯ã€åœ¨ã€æˆ‘ã€æœ‰ç­‰
        Set<String> stopWords = Set.of("çš„", "äº†", "æ˜¯", "åœ¨", "æˆ‘", "æœ‰", "å’Œ", "å°±", "ä¸", "äºº", "éƒ½", "ä¸€", "ä¸€ä¸ª", "ä¸Š", "ä¹Ÿ", "å¾ˆ", "åˆ°", "è¯´", "è¦", "å»", "ä½ ", "ä¼š", "ç€", "æ²¡æœ‰", "çœ‹", "å¥½", "è‡ªå·±", "è¿™");
        return stopWords.contains(word);
    }
    
    private boolean containsAny(Set<String> set, String... keywords) {
        return Arrays.stream(keywords).anyMatch(set::contains);
    }
}
```

#### 2.2.2 å¾®ä¿¡ç™»å½•æœåŠ¡ï¼ˆJWT + å­¦å·ç»‘å®šï¼‰

```java
@Service
@Slf4j
public class WxAuthServiceImpl implements WxAuthService {
    
    @Value("${wechat.miniapp.appid}")
    private String appid;
    
    @Value("${wechat.miniapp.secret}")
    private String secret;
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private StudentMapper studentMapper;
    
    @Autowired
    private JwtTokenUtil jwtTokenUtil;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * å¾®ä¿¡å°ç¨‹åºç™»å½•ï¼ˆå¯¹åº”ä»»åŠ¡ä¹¦"å­¦ç”Ÿç™»å½•ç»‘å®šå­¦å·"ï¼‰
     * 1. å¾®ä¿¡codeæ¢session
     * 2. æŸ¥è¯¢æˆ–åˆ›å»ºç”¨æˆ·
     * 3. ç”ŸæˆJWT Token
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public LoginResultVO login(String code) {
        // 1. è¯·æ±‚å¾®ä¿¡æ¥å£æ¢å–openidå’Œsession_key
        String url = String.format(
            "https://api.weixin.qq.com/sns/jscode2session?appid=%s&secret=%s&js_code=%s&grant_type=authorization_code",
            appid, secret, code
        );
        
        WxSessionResponse wxResp = restTemplate.getForObject(url, WxSessionResponse.class);
        
        if (wxResp == null || wxResp.getOpenid() == null) {
            log.error("å¾®ä¿¡ç™»å½•å¤±è´¥: {}", wxResp != null ? wxResp.getErrmsg() : "æ— å“åº”");
            throw new BizException("B1001", "å¾®ä¿¡ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // 2. æŸ¥è¯¢æˆ–åˆ›å»ºç”¨æˆ·
        User user = userMapper.selectOne(
            new LambdaQueryWrapper<User>()
                .eq(User::getOpenid, wxResp.getOpenid())
        );
        
        boolean isNewUser = false;
        if (user == null) {
            user = new User();
            user.setOpenid(wxResp.getOpenid());
            user.setUnionid(wxResp.getUnionid());
            user.setSessionKey(wxResp.getSession_key());
            user.setUserType(UserType.STUDENT);  // é»˜è®¤å­¦ç”Ÿ
            user.setStatus(UserStatus.ACTIVE);
            user.setCreateTime(LocalDateTime.now());
            userMapper.insert(user);
            isNewUser = true;
            log.info("æ–°ç”¨æˆ·æ³¨å†Œ: openid={}", wxResp.getOpenid());
        } else {
            // æ›´æ–°session_key
            user.setSessionKey(wxResp.getSession_key());
            user.setUpdateTime(LocalDateTime.now());
            userMapper.updateById(user);
        }
        
        // 3. ç”ŸæˆJWT Tokenï¼ˆåŒ…å«ç”¨æˆ·IDå’Œè§’è‰²ï¼‰
        String token = jwtTokenUtil.generateToken(
            user.getId(), 
            user.getUserType().name(),
            user.getStudentNo() != null  // æ˜¯å¦å·²ç»‘å®šå­¦å·
        );
        
        // 4. è¿”å›ç™»å½•ç»“æœ
        return LoginResultVO.builder()
            .token(token)
            .expiresIn(jwtTokenUtil.getExpiration())
            .isNewUser(isNewUser)
            .isBound(user.getStudentNo() != null)
            .userType(user.getUserType())
            .build();
    }
    
    /**
     * å­¦å·ç»‘å®šï¼ˆä»»åŠ¡ä¹¦"å­¦ç”Ÿç™»å½•ç»‘å®šå­¦å·åï¼Œç³»ç»Ÿå¯ä¾æ®å…¶å¹´çº§ã€ä¸“ä¸šå±æ€§"ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void bindStudent(Long userId, String studentNo, String idCard, String name) {
        // 1. æ ¡éªŒå­¦å·æ˜¯å¦å­˜åœ¨ä¸”æœªç»‘å®š
        Student student = studentMapper.selectOne(
            new LambdaQueryWrapper<Student>()
                .eq(Student::getStudentNo, studentNo)
                .eq(Student::getIdCard, idCard)
                .eq(Student::getName, name)
        );
        
        if (student == null) {
            throw new BizException("B1002", "å­¦å·ä¿¡æ¯æ ¡éªŒå¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥");
        }
        
        // 2. æ£€æŸ¥æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ç»‘å®š
        User existingUser = userMapper.selectOne(
            new LambdaQueryWrapper<User>()
                .eq(User::getStudentNo, studentNo)
                .ne(User::getId, userId)
        );
        if (existingUser != null) {
            throw new BizException("B1003", "è¯¥å­¦å·å·²è¢«å…¶ä»–è´¦å·ç»‘å®š");
        }
        
        // 3. æ›´æ–°ç”¨æˆ·ç»‘å®šä¿¡æ¯
        User user = userMapper.selectById(userId);
        user.setStudentNo(studentNo);
        user.setRealName(name);
        user.setGrade(student.getGrade());
        user.setMajor(student.getMajor());
        user.setCollegeId(student.getCollegeId());
        user.setUpdateTime(LocalDateTime.now());
        userMapper.updateById(user);
        
        log.info("å­¦å·ç»‘å®šæˆåŠŸ: userId={}, studentNo={}", userId, studentNo);
    }
    
    /**
     * åŸºäºèº«ä»½çš„ä¿¡æ¯ç­›é€‰ï¼ˆä»»åŠ¡ä¹¦"ä¸ªæ€§åŒ–ä¿¡æ¯ç­›é€‰"ï¼‰
     * æ ¹æ®å¹´çº§ã€ä¸“ä¸šä¼˜å…ˆæ˜¾ç¤ºç›¸å…³é€šçŸ¥
     */
    @Override
    public List<NoticeVO> getPersonalizedNotices(Long userId, int limit) {
        User user = userMapper.selectById(userId);
        if (user == null || user.getStudentNo() == null) {
            // æœªç»‘å®šå­¦å·ï¼Œè¿”å›é€šç”¨é€šçŸ¥
            return noticeService.getGeneralNotices(limit);
        }
        
        // ä¼˜å…ˆæŸ¥è¯¢é’ˆå¯¹è¯¥å¹´çº§/ä¸“ä¸šçš„é€šçŸ¥
        List<Notice> targeted = noticeMapper.selectTargetedNotices(
            user.getGrade(),
            user.getMajor(),
            user.getCollegeId(),
            limit
        );
        
        // è¡¥å……å…¨æ ¡é€šçŸ¥
        int remain = limit - targeted.size();
        if (remain > 0) {
            List<Notice> general = noticeMapper.selectGeneralNotices(remain);
            targeted.addAll(general);
        }
        
        return targeted.stream().map(this::convertToVO).collect(Collectors.toList());
    }
}
```

#### 2.2.3 é€šçŸ¥ç®¡ç†æœåŠ¡ï¼ˆå‘å¸ƒèŒƒå›´æ§åˆ¶ + è®¢é˜…æ¨é€ï¼‰

```java
@Service
@Slf4j
public class NoticeServiceImpl implements NoticeService {
    
    @Autowired
    private NoticeMapper noticeMapper;
    
    @Autowired
    private NoticeSubscriptionMapper subscriptionMapper;
    
    @Autowired
    private WxMsgService wxMsgService;
    
    /**
     * å‘å¸ƒé€šçŸ¥ï¼ˆä»»åŠ¡ä¹¦"å‘å¸ƒèŒƒå›´æ§åˆ¶"ï¼‰
     * å¯è®¾å®šé€šçŸ¥çš„å¯è§èŒƒå›´ï¼šå…¨æ ¡ã€æŒ‡å®šå­¦é™¢ã€æŒ‡å®šå¹´çº§
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    @PreAuthorize("hasAuthority('NOTICE:PUBLISH')")
    public Long publishNotice(NoticePublishDTO dto, Long publisherId) {
        // 1. æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆä»»åŠ¡ä¹¦"å†…å®¹å®‰å…¨ä¸å®¡è®¡"ï¼‰
        String filteredTitle = sensitiveWordFilter.filter(dto.getTitle());
        String filteredContent = sensitiveWordFilter.filter(dto.getContent());
        
        // 2. åˆ›å»ºé€šçŸ¥
        Notice notice = new Notice();
        notice.setTitle(filteredTitle);
        notice.setContent(filteredContent);
        notice.setDepartmentId(dto.getDepartmentId());
        notice.setPublisherId(publisherId);
        notice.setUrgencyLevel(dto.getUrgencyLevel());  // ç´§æ€¥ç¨‹åº¦
        notice.setVisibilityType(dto.getVisibilityType());  // å¯è§èŒƒå›´ç±»å‹
        
        // 3. è®¾ç½®å¯è§èŒƒå›´
        switch (dto.getVisibilityType()) {
            case ALL:
                notice.setTargetCollegeId(null);
                notice.setTargetGrade(null);
                break;
            case COLLEGE:
                notice.setTargetCollegeId(dto.getTargetCollegeId());
                notice.setTargetGrade(null);
                break;
            case GRADE:
                notice.setTargetCollegeId(dto.getTargetCollegeId());
                notice.setTargetGrade(dto.getTargetGrade());
                break;
            case MAJOR:
                notice.setTargetMajor(dto.getTargetMajor());
                break;
        }
        
        notice.setStatus(NoticeStatus.PUBLISHED);
        notice.setPublishTime(LocalDateTime.now());
        noticeMapper.insert(notice);
        
        // 4. æ¨é€ç»™è®¢é˜…ç”¨æˆ·ï¼ˆä»»åŠ¡ä¹¦"è®¢é˜…ä¸æ¨é€"ï¼‰
        if (dto.getUrgencyLevel() == UrgencyLevel.URGENT) {
            pushToSubscribers(notice);
        }
        
        log.info("é€šçŸ¥å‘å¸ƒæˆåŠŸ: id={}, title={}, visibility={}", 
            notice.getId(), notice.getTitle(), dto.getVisibilityType());
        
        return notice.getId();
    }
    
    /**
     * å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯æ¨é€ï¼ˆé‡è¦é€šçŸ¥ï¼‰
     */
    private void pushToSubscribers(Notice notice) {
        // æŸ¥è¯¢è®¢é˜…äº†è¯¥éƒ¨é—¨çš„ç”¨æˆ·
        List<Long> subscriberIds = subscriptionMapper
            .selectUserIdsByDepartment(notice.getDepartmentId());
        
        // è¿‡æ»¤ç¬¦åˆå¯è§èŒƒå›´çš„ç”¨æˆ·
        List<Long> targetUsers = subscriberIds.stream()
            .filter(userId -> isInVisibilityRange(userId, notice))
            .collect(Collectors.toList());
        
        // æ‰¹é‡å‘é€æ¨¡æ¿æ¶ˆæ¯ï¼ˆå¼‚æ­¥ï¼‰
        wxMsgService.sendTemplateMessageAsync(targetUsers, notice);
    }
    
    private boolean isInVisibilityRange(Long userId, Notice notice) {
        User user = userMapper.selectById(userId);
        if (user == null || user.getStudentNo() == null) {
            return notice.getVisibilityType() == VisibilityType.ALL;
        }
        
        switch (notice.getVisibilityType()) {
            case ALL:
                return true;
            case COLLEGE:
                return Objects.equals(user.getCollegeId(), notice.getTargetCollegeId());
            case GRADE:
                return Objects.equals(user.getCollegeId(), notice.getTargetCollegeId())
                    && Objects.equals(user.getGrade(), notice.getTargetGrade());
            case MAJOR:
                return Objects.equals(user.getMajor(), notice.getTargetMajor());
            default:
                return false;
        }
    }
}
```

---

## ç¬¬3ç«  å¾®ä¿¡å°ç¨‹åºç¼–ç è§„èŒƒ

### 3.1 å…¨å±€é…ç½®ä¸æ ·å¼

**app.jsonï¼ˆé¡µé¢è·¯ç”±ä¸TabBarï¼‰**ï¼š
```json
{
  "pages": [
    "pages/index/index",
    "pages/search/search",
    "pages/qa-detail/qa-detail",
    "pages/notice/notice",
    "pages/guide/guide",
    "pages/profile/profile",
    "pages/login/login",
    "pages/student-bind/student-bind"
  ],
  "tabBar": {
    "color": "#999999",
    "selectedColor": "#1a365d",
    "backgroundColor": "#ffffff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "é¦–é¡µ",
        "iconPath": "images/icon_home.png",
        "selectedIconPath": "images/icon_home_active.png"
      },
      {
        "pagePath": "pages/notice/notice",
        "text": "é€šçŸ¥",
        "iconPath": "images/icon_notice.png",
        "selectedIconPath": "images/icon_notice_active.png"
      },
      {
        "pagePath": "pages/guide/guide",
        "text": "åŠäº‹",
        "iconPath": "images/icon_guide.png",
        "selectedIconPath": "images/icon_guide_active.png"
      },
      {
        "pagePath": "pages/profile/profile",
        "text": "æˆ‘çš„",
        "iconPath": "images/icon_profile.png",
        "selectedIconPath": "images/icon_profile_active.png"
      }
    ]
  },
  "window": {
    "backgroundTextStyle": "dark",
    "navigationBarBackgroundColor": "#1a365d",
    "navigationBarTitleText": "æ ¡å›­æ™ºèƒ½é—®ç­”",
    "navigationBarTextStyle": "white"
  },
  "usingComponents": {
    "search-bar": "/components/search-bar/search-bar",
    "category-tree": "/components/category-tree/category-tree",
    "qa-card": "/components/qa-card/qa-card",
    "notice-item": "/components/notice-item/notice-item"
  },
  "permission": {
    "scope.userInfo": {
      "desc": "ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™"
    }
  },
  "requiredBackgroundModes": ["audio"],
  "sitemapLocation": "sitemap.json"
}
```

**app.wxssï¼ˆå…¨å±€æ ·å¼å˜é‡ï¼‰**ï¼š
```css
/* æ ¡å›­æ™ºèƒ½é—®ç­”ç³»ç»Ÿ - è®¾è®¡ç³»ç»Ÿ */
page {
  /* ä¸»è‰² - æ·±é›è“ï¼ˆå­¦æœ¯ç¨³é‡ï¼‰ */
  --primary: #1a365d;
  --primary-light: #2c5282;
  --primary-dark: #0f2942;
  
  /* è¾…åŠ©è‰² - æ´»åŠ›æ©™ï¼ˆæé†’é‡è¦ï¼‰ */
  --secondary: #ed8936;
  --secondary-light: #f6ad55;
  
  /* åŠŸèƒ½è‰² */
  --success: #38a169;
  --warning: #d69e2e;
  --error: #e53e3e;
  --info: #3182ce;
  
  /* ç´§æ€¥ç¨‹åº¦ä¸“ç”¨è‰²ï¼ˆä»»åŠ¡ä¹¦"æŒ‰ç´§æ€¥ç¨‹åº¦ç­›é€‰"ï¼‰ */
  --urgency-urgent: #e53e3e;    /* ç´§æ€¥ - çº¢ */
  --urgency-important: #ed8936; /* é‡è¦ - æ©™ */
  --urgency-normal: #3182ce;    /* æ™®é€š - è“ */
  
  /* åˆ†ç±»è‰²ï¼ˆæ•™åŠ¡/å­¦å·¥/åå‹¤ï¼‰ */
  --cat-academic: #3182ce;   /* æ•™åŠ¡ - è“ */
  --cat-student: #38a169;    /* å­¦å·¥ - ç»¿ */
  --cat-logistics: #d69e2e;  /* åå‹¤ - é»„ */
  --cat-general: #718096;    /* é€šç”¨ - ç° */
  
  /* æ–‡å­—è‰² */
  --text-primary: #1a202c;
  --text-secondary: #4a5568;
  --text-tertiary: #718096;
  --text-white: #ffffff;
  
  /* èƒŒæ™¯è‰² */
  --bg-primary: #f7fafc;
  --bg-secondary: #edf2f7;
  --bg-white: #ffffff;
  
  /* é—´è· - 8pxåŸºå‡† */
  --space-1: 8rpx;
  --space-2: 16rpx;
  --space-3: 24rpx;
  --space-4: 32rpx;
  --space-5: 48rpx;
  
  /* åœ†è§’ */
  --radius-sm: 8rpx;
  --radius-md: 16rpx;
  --radius-lg: 24rpx;
  
  /* é˜´å½± */
  --shadow-sm: 0 2rpx 4rpx rgba(0,0,0,0.05);
  --shadow-md: 0 4rpx 12rpx rgba(0,0,0,0.1);
  
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  font-size: 28rpx;
  color: var(--text-primary);
  background-color: var(--bg-primary);
}
```

### 3.2 æ ¸å¿ƒé¡µé¢æ¨¡æ¿

#### 3.2.1 é¦–é¡µï¼ˆæœç´¢å…¥å£ + çƒ­é—¨é—®é¢˜ + åˆ†ç±»æ ‘ï¼‰

**pages/index/index.wxml**ï¼š
```html
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-header">
    <search-bar 
      value="{{query}}" 
      placeholder="è¯·è¾“å…¥é—®é¢˜ï¼Œå¦‚ï¼šè¯¾è¡¨æŸ¥è¯¢ã€å¥–å­¦é‡‘ç”³è¯·"
      hotKeywords="{{hotKeywords}}"
      bind:search="onSearch"
      bind:focus="onSearchFocus"
    />
  </view>
  
  <!-- åˆ†ç±»å¿«æ·å…¥å£ï¼ˆä»»åŠ¡ä¹¦"æŒ‰éƒ¨é—¨/ç±»å‹åˆ†ç±»æ ‘"ï¼‰ -->
  <view class="category-section">
    <view class="section-title">æœåŠ¡åˆ†ç±»</view>
    <category-tree 
      categories="{{categories}}"
      bind:select="onCategorySelect"
    />
  </view>
  
  <!-- çƒ­é—¨é—®é¢˜ï¼ˆä»»åŠ¡ä¹¦"æœç´¢æ¡†è¾“å…¥æ—¶æä¾›çƒ­é—¨é—®é¢˜è”æƒ³"ï¼‰ -->
  <view class="hot-qa-section" wx:if="{{!query}}">
    <view class="section-title">
      <text>çƒ­é—¨é—®é¢˜</text>
      <text class="update-time">æ¯å°æ—¶æ›´æ–°</text>
    </view>
    <view class="hot-list">
      <view 
        class="hot-item" 
        wx:for="{{hotQas}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bind:tap="goToQaDetail"
      >
        <text class="rank {{index < 3 ? 'top' : ''}}">{{index + 1}}</text>
        <text class="title">{{item.title}}</text>
        <text class="heat">{{item.clickCount}}äººçœ‹è¿‡</text>
      </view>
    </view>
  </view>
  
  <!-- æœ€è¿‘æœç´¢ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ -->
  <view class="history-section" wx:if="{{searchHistory.length > 0 && !query}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘æœç´¢</text>
      <text class="clear-btn" bind:tap="clearHistory">æ¸…ç©º</text>
    </view>
    <view class="history-tags">
      <text 
        class="tag" 
        wx:for="{{searchHistory}}" 
        wx:key="*this"
        data-query="{{item}}"
        bind:tap="onHistoryTap"
      >{{item}}</text>
    </view>
  </view>
  
  <!-- ä¸ªæ€§åŒ–æ¨èï¼ˆä»»åŠ¡ä¹¦"åŸºäºèº«ä»½çš„ä¿¡æ¯ç­›é€‰"ï¼‰ -->
  <view class="recommend-section" wx:if="{{personalizedNotices.length > 0}}">
    <view class="section-title">
      <text>ä¸ä½ ç›¸å…³</text>
      <text class="tag" wx:if="{{userInfo.grade}}">{{userInfo.grade}}çº§</text>
    </view>
    <notice-item 
      wx:for="{{personalizedNotices}}" 
      wx:key="id"
      notice="{{item}}"
      bind:tap="goToNoticeDetail"
    />
  </view>
</view>
```

**pages/index/index.wxss**ï¼š
```css
.container {
  padding: var(--space-3);
}

.search-header {
  margin-bottom: var(--space-4);
}

.section-title {
  font-size: 32rpx;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-3);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.section-title .update-time {
  font-size: 24rpx;
  font-weight: normal;
  color: var(--text-tertiary);
}

/* çƒ­é—¨é—®é¢˜åˆ—è¡¨ */
.hot-qa-section {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: var(--space-3);
  margin-bottom: var(--space-4);
  box-shadow: var(--shadow-sm);
}

.hot-list {
  display: flex;
  flex-direction: column;
}

.hot-item {
  display: flex;
  align-items: center;
  padding: var(--space-2) 0;
  border-bottom: 1rpx solid var(--bg-secondary);
}

.hot-item:last-child {
  border-bottom: none;
}

.hot-item .rank {
  width: 40rpx;
  height: 40rpx;
  line-height: 40rpx;
  text-align: center;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  font-size: 24rpx;
  color: var(--text-secondary);
  margin-right: var(--space-2);
}

.hot-item .rank.top {
  background: var(--secondary);
  color: var(--text-white);
}

.hot-item .title {
  flex: 1;
  font-size: 28rpx;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.hot-item .heat {
  font-size: 24rpx;
  color: var(--text-tertiary);
  margin-left: var(--space-2);
}

/* æœ€è¿‘æœç´¢ */
.history-section {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: var(--space-3);
  margin-bottom: var(--space-4);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-2);
}

.clear-btn {
  font-size: 26rpx;
  color: var(--text-tertiary);
}

.history-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

.tag {
  padding: var(--space-1) var(--space-2);
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  font-size: 26rpx;
  color: var(--text-secondary);
}

/* ä¸ªæ€§åŒ–æ¨è */
.recommend-section {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: var(--space-3);
}

.recommend-section .tag {
  background: var(--primary);
  color: var(--text-white);
  font-size: 22rpx;
  padding: 4rpx 12rpx;
  border-radius: var(--radius-sm);
  margin-left: var(--space-2);
}
```

**pages/index/index.js**ï¼š
```javascript
const qaService = require('../../services/qaService');
const noticeService = require('../../services/noticeService');
const auth = require('../../utils/auth');

Page({
  data: {
    query: '',
    hotKeywords: [],
    categories: [],
    hotQas: [],
    searchHistory: [],
    personalizedNotices: [],
    userInfo: {}
  },

  onLoad() {
    // æ£€æŸ¥ç™»å½•æ€
    if (!auth.checkLogin()) {
      wx.redirectTo({ url: '/pages/login/login' });
      return;
    }
    
    this.loadInitialData();
    this.loadSearchHistory();
  },

  onShow() {
    // æ¯æ¬¡æ˜¾ç¤ºåˆ·æ–°ä¸ªæ€§åŒ–å†…å®¹
    if (auth.checkLogin()) {
      this.loadPersonalizedContent();
    }
  },

  // åŠ è½½åˆå§‹æ•°æ®
  async loadInitialData() {
    try {
      const [categories, hotQas, hotKeywords] = await Promise.all([
        qaService.getCategories(),
        qaService.getHotQas(10),
        qaService.getHotKeywords()
      ]);
      
      this.setData({
        categories,
        hotQas,
        hotKeywords
      });
    } catch (err) {
      console.error('åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:', err);
    }
  },

  // åŠ è½½ä¸ªæ€§åŒ–å†…å®¹ï¼ˆä»»åŠ¡ä¹¦"åŸºäºèº«ä»½çš„ä¿¡æ¯ç­›é€‰"ï¼‰
  async loadPersonalizedContent() {
    try {
      const userInfo = auth.getUserInfo();
      const notices = await noticeService.getPersonalized(5);
      
      this.setData({
        userInfo: userInfo || {},
        personalizedNotices: notices
      });
    } catch (err) {
      console.error('åŠ è½½ä¸ªæ€§åŒ–å†…å®¹å¤±è´¥:', err);
    }
  },

  // æœç´¢å†å²ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
  loadSearchHistory() {
    const history = wx.getStorageSync('searchHistory') || [];
    this.setData({ searchHistory: history.slice(0, 10) });
  },

  saveSearchHistory(query) {
    if (!query.trim()) return;
    let history = wx.getStorageSync('searchHistory') || [];
    history = history.filter(item => item !== query);
    history.unshift(query);
    history = history.slice(0, 10);
    wx.setStorageSync('searchHistory', history);
    this.setData({ searchHistory: history });
  },

  clearHistory() {
    wx.removeStorageSync('searchHistory');
    this.setData({ searchHistory: [] });
  },

  // äº‹ä»¶å¤„ç†
  onSearch(e) {
    const query = e.detail.value.trim();
    if (!query) {
      wx.showToast({ title: 'è¯·è¾“å…¥æœç´¢å†…å®¹', icon: 'none' });
      return;
    }
    
    this.saveSearchHistory(query);
    wx.navigateTo({
      url: `/pages/search/search?query=${encodeURIComponent(query)}`
    });
  },

  onSearchFocus() {
    // æœç´¢æ¡†èšç„¦æ—¶æ˜¾ç¤ºè”æƒ³æç¤º
    // å·²å®ç°äºsearch-barç»„ä»¶å†…
  },

  onHistoryTap(e) {
    const query = e.currentTarget.dataset.query;
    this.onSearch({ detail: { value: query } });
  },

  onCategorySelect(e) {
    const { id, name } = e.detail;
    wx.navigateTo({
      url: `/pages/search/search?categoryId=${id}&categoryName=${encodeURIComponent(name)}`
    });
  },

  goToQaDetail(e) {
    const id = e.currentTarget.dataset.id;
    wx.navigateTo({ url: `/pages/qa-detail/qa-detail?id=${id}` });
  },

  goToNoticeDetail(e) {
    const id = e.currentTarget.dataset.id;
    wx.navigateTo({ url: `/pages/notice/notice-detail?id=${id}` });
  }
});
```

#### 3.2.2 æœç´¢ç»“æœé¡µï¼ˆå¤šæ¨¡å¼æ£€ç´¢ + æ’åºï¼‰

**pages/search/search.wxml**ï¼š
```html
<view class="container">
  <!-- æœç´¢æ ï¼ˆå¸¦å½“å‰æœç´¢è¯ï¼‰ -->
  <search-bar 
    value="{{query}}" 
    placeholder="è¯·è¾“å…¥é—®é¢˜å…³é”®è¯"
    bind:search="onSearch"
  />
  
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" 
          data-type="all" bind:tap="onFilterChange">å…¨éƒ¨</view>
    <view class="filter-item {{currentFilter === 'academic' ? 'active' : ''}}" 
          data-type="academic" bind:tap="onFilterChange">æ•™åŠ¡</view>
    <view class="filter-item {{currentFilter === 'student' ? 'active' : ''}}" 
          data-type="student" bind:tap="onFilterChange">å­¦å·¥</view>
    <view class="filter-item {{currentFilter === 'logistics' ? 'active' : ''}}" 
          data-type="logistics" bind:tap="onFilterChange">åå‹¤</view>
    
    <view class="sort-btn" bind:tap="toggleSort">
      <text>{{sortText}}</text>
      <text class="arrow">{{sortAsc ? 'â†‘' : 'â†“'}}</text>
    </view>
  </view>
  
  <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="result-list"
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="loadMore"
  >
    <!-- ç»“æœç»Ÿè®¡ -->
    <view class="result-stats" wx:if="{{results.length > 0}}">
      æ‰¾åˆ° <text class="highlight">{{totalCount}}</text> ä¸ªç›¸å…³ç»“æœ
      <text wx:if="{{intentType}}">ï¼Œè¯†åˆ«æ„å›¾ï¼š{{intentType}}</text>
    </view>
    
    <!-- é—®ç­”å¡ç‰‡åˆ—è¡¨ -->
    <qa-card 
      wx:for="{{results}}" 
      wx:key="id"
      qa="{{item}}"
      highlightKeywords="{{keywords}}"
      bind:tap="goToDetail"
      bind:feedback="onFeedback"
    />
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && results.length === 0 && !refreshing}}">
      <image src="/images/empty-search.png" mode="aspectFit"/>
      <text>æœªæ‰¾åˆ°ç›¸å…³é—®é¢˜</text>
      <text class="sub">æ¢ä¸ªå…³é”®è¯è¯•è¯•ï¼Œæˆ–æŸ¥çœ‹åŠäº‹æŒ‡å—</text>
      <button class="action-btn" bind:tap="goToGuide">æŸ¥çœ‹åŠäº‹æŒ‡å—</button>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>æœç´¢ä¸­...</text>
    </view>
    
    <view class="no-more" wx:if="{{noMore && results.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
  </scroll-view>
</view>
```

**pages/search/search.js**ï¼š
```javascript
const qaService = require('../../services/qaService');

Page({
  data: {
    query: '',
    categoryId: null,
    categoryName: '',
    currentFilter: 'all',
    sortType: 'relevance', // relevance | hot | time
    sortAsc: false,
    sortText: 'ç›¸å…³åº¦',
    keywords: [],
    intentType: '',
    results: [],
    page: 1,
    size: 10,
    totalCount: 0,
    loading: false,
    noMore: false,
    refreshing: false
  },

  onLoad(options) {
    // æ¥æ”¶å‚æ•°ï¼šqueryæˆ–categoryId
    if (options.query) {
      this.setData({ 
        query: decodeURIComponent(options.query),
        keywords: decodeURIComponent(options.query).split(/\s+/)
      });
    }
    if (options.categoryId) {
      this.setData({
        categoryId: parseInt(options.categoryId),
        categoryName: decodeURIComponent(options.categoryName || ''),
        currentFilter: this.getFilterType(parseInt(options.categoryId))
      });
    }
    
    this.loadData();
  },

  getFilterType(categoryId) {
    // åˆ†ç±»IDæ˜ å°„åˆ°filterç±»å‹
    const map = { 1: 'academic', 2: 'student', 3: 'logistics' };
    return map[categoryId] || 'all';
  },

  async loadData(reset = false) {
    if (this.data.loading) return;
    
    if (reset) {
      this.setData({ page: 1, results: [], noMore: false });
    }
    
    this.setData({ loading: true });
    
    try {
      const res = await qaService.search({
        query: this.data.query,
        categoryId: this.data.categoryId,
        sortType: this.data.sortType,
        page: this.data.page,
        size: this.data.size
      });
      
      const newResults = reset ? res.results : [...this.data.results, ...res.results];
      
      this.setData({
        results: newResults,
        totalCount: res.totalCount,
        keywords: res.keywords || this.data.keywords,
        intentType: res.intentType || '',
        page: this.data.page + 1,
        noMore: res.results.length < this.data.size
      });
    } catch (err) {
      wx.showToast({ title: err.message || 'æœç´¢å¤±è´¥', icon: 'none' });
    } finally {
      this.setData({ loading: false, refreshing: false });
    }
  },

  onRefresh() {
    this.setData({ refreshing: true });
    this.loadData(true);
  },

  loadMore() {
    if (!this.data.noMore && !this.data.loading) {
      this.loadData();
    }
  },

  onSearch(e) {
    const query = e.detail.value.trim();
    this.setData({ 
      query, 
      keywords: query.split(/\s+/),
      page: 1 
    });
    this.loadData(true);
  },

  onFilterChange(e) {
    const type = e.currentTarget.dataset.type;
    const categoryMap = { all: null, academic: 1, student: 2, logistics: 3 };
    
    this.setData({
      currentFilter: type,
      categoryId: categoryMap[type],
      page: 1
    });
    this.loadData(true);
  },

  toggleSort() {
    const sortTypes = [
      { type: 'relevance', text: 'ç›¸å…³åº¦' },
      { type: 'hot', text: 'çƒ­åº¦' },
      { type: 'time', text: 'æœ€æ–°' }
    ];
    
    const currentIndex = sortTypes.findIndex(s => s.type === this.data.sortType);
    const nextIndex = (currentIndex + 1) % sortTypes.length;
    const next = sortTypes[nextIndex];
    
    this.setData({
      sortType: next.type,
      sortText: next.text,
      sortAsc: next.type === 'time', // æ—¶é—´é»˜è®¤å€’åºï¼ˆæœ€æ–°åœ¨å‰ï¼‰
      page: 1
    });
    this.loadData(true);
  },

  goToDetail(e) {
    const id = e.currentTarget.dataset.id;
    wx.navigateTo({ url: `/pages/qa-detail/qa-detail?id=${id}` });
  },

  goToGuide() {
    wx.switchTab({ url: '/pages/guide/guide' });
  },

  onFeedback(e) {
    const { id, useful } = e.detail;
    qaService.submitFeedback(id, useful).then(() => {
      wx.showToast({ title: 'æ„Ÿè°¢æ‚¨çš„åé¦ˆ', icon: 'success' });
    });
  }
});
```

### 3.3 è¯·æ±‚å°è£…ï¼ˆå¸¦Tokenè‡ªåŠ¨ç»­æœŸï¼‰

**utils/request.js**ï¼š
```javascript
const auth = require('./auth');

const BASE_URL = 'https://smartcampus.hbut.edu.cn/api'; // ç”Ÿäº§ç¯å¢ƒ
// const BASE_URL = 'http://localhost:8080/api'; // å¼€å‘ç¯å¢ƒ

const request = (options) => {
  return new Promise((resolve, reject) => {
    const token = auth.getToken();
    
    wx.request({
      url: `${BASE_URL}${options.url}`,
      method: options.method || 'GET',
      data: options.data,
      header: {
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : '',
        'X-Request-ID': generateUUID(), // å¹‚ç­‰æ€§é”®
        ...options.header
      },
      success: (res) => {
        if (res.statusCode === 200) {
          const data = res.data;
          if (data.code === 'A0000') {
            resolve(data.data);
          } else if (data.code === 'B4002' || data.code === 'B4003') {
            // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
            auth.refreshToken().then(newToken => {
              // é‡è¯•åŸè¯·æ±‚
              request(options).then(resolve).catch(reject);
            }).catch(() => {
              // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•
              auth.clearLogin();
              wx.redirectTo({ url: '/pages/login/login' });
              reject(new Error('ç™»å½•å·²è¿‡æœŸ'));
            });
          } else {
            reject(new Error(data.message || 'è¯·æ±‚å¤±è´¥'));
          }
        } else if (res.statusCode === 401) {
          auth.clearLogin();
          wx.redirectTo({ url: '/pages/login/login' });
          reject(new Error('æœªç™»å½•'));
        } else {
          reject(new Error(`æœåŠ¡å™¨é”™è¯¯: ${res.statusCode}`));
        }
      },
      fail: (err) => {
        reject(new Error(err.errMsg || 'ç½‘ç»œè¯·æ±‚å¤±è´¥'));
      }
    });
  });
};

const get = (url, params) => request({ url, method: 'GET', data: params });
const post = (url, data) => request({ url, method: 'POST', data });
const put = (url, data) => request({ url, method: 'PUT', data });
const del = (url) => request({ url, method: 'DELETE' });

function generateUUID() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

module.exports = {
  request,
  get,
  post,
  put,
  delete: del
};
```

**utils/auth.js**ï¼š
```javascript
const TOKEN_KEY = 'access_token';
const REFRESH_KEY = 'refresh_token';
const USER_INFO_KEY = 'user_info';

module.exports = {
  // è·å–Token
  getToken() {
    return wx.getStorageSync(TOKEN_KEY);
  },
  
  // è·å–Refresh Token
  getRefreshToken() {
    return wx.getStorageSync(REFRESH_KEY);
  },
  
  // ä¿å­˜ç™»å½•æ€
  setLogin(token, refreshToken, userInfo) {
    wx.setStorageSync(TOKEN_KEY, token);
    wx.setStorageSync(REFRESH_KEY, refreshToken);
    wx.setStorageSync(USER_INFO_KEY, userInfo);
  },
  
  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfo() {
    return wx.getStorageSync(USER_INFO_KEY);
  },
  
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  checkLogin() {
    const token = this.getToken();
    return !!token;
  },
  
  // æ¸…é™¤ç™»å½•æ€
  clearLogin() {
    wx.removeStorageSync(TOKEN_KEY);
    wx.removeStorageSync(REFRESH_KEY);
    wx.removeStorageSync(USER_INFO_KEY);
  },
  
  // åˆ·æ–°Tokenï¼ˆåç«¯éœ€å®ç°refreshæ¥å£ï¼‰
  refreshToken() {
    return new Promise((resolve, reject) => {
      const refreshToken = this.getRefreshToken();
      if (!refreshToken) {
        reject(new Error('æ— åˆ·æ–°ä»¤ç‰Œ'));
        return;
      }
      
      wx.request({
        url: 'https://smartcampus.hbut.edu.cn/api/auth/refresh',
        method: 'POST',
        header: { 'Authorization': `Bearer ${refreshToken}` },
        success: (res) => {
          if (res.data.code === 'A0000') {
            const { token, refreshToken: newRefresh, expiresIn } = res.data.data;
            const userInfo = this.getUserInfo();
            this.setLogin(token, newRefresh, userInfo);
            resolve(token);
          } else {
            reject(new Error('åˆ·æ–°å¤±è´¥'));
          }
        },
        fail: reject
      });
    });
  }
};
```

---

## ç¬¬4ç«  ç®¡ç†åå°ç¼–ç è§„èŒƒï¼ˆVue3 + Element UIï¼‰

### 4.1 é¡¹ç›®ç»“æ„ä¸é…ç½®

**æŠ€æœ¯æ ˆ**ï¼šVue 3.4 + Vite 5 + Element Plus 2.5 + Pinia 2.1 + Axios 1.6

**vite.config.js**ï¼š
```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
});
```

### 4.2 æ ¸å¿ƒé¡µé¢æ¨¡æ¿

#### 4.2.1 é—®ç­”åº“ç®¡ç†ï¼ˆä¿¡æ¯å‘˜è§’è‰²ï¼‰

**src/views/qa/QaManagement.vue**ï¼š
```vue
<template>
  <div class="qa-management">
    <!-- æœç´¢æ  -->
    <el-card class="search-card">
      <el-form :model="searchForm" inline>
        <el-form-item label="å…³é”®è¯">
          <el-input v-model="searchForm.keyword" placeholder="æ ‡é¢˜/å†…å®¹" clearable />
        </el-form-item>
        <el-form-item label="åˆ†ç±»">
          <el-select v-model="searchForm.categoryId" placeholder="å…¨éƒ¨" clearable>
            <el-option 
              v-for="cat in categories" 
              :key="cat.id" 
              :label="cat.name" 
              :value="cat.id" 
            />
          </el-select>
        </el-form-item>
        <el-form-item label="çŠ¶æ€">
          <el-select v-model="searchForm.status" placeholder="å…¨éƒ¨" clearable>
            <el-option label="è‰ç¨¿" :value="0" />
            <el-option label="å¾…å®¡æ ¸" :value="1" />
            <el-option label="å·²å‘å¸ƒ" :value="2" />
            <el-option label="å·²é©³å›" :value="3" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">æŸ¥è¯¢</el-button>
          <el-button @click="resetSearch">é‡ç½®</el-button>
          <el-button type="success" @click="handleAdd" v-permission="'QA:CREATE'">
            æ–°å¢é—®ç­”
          </el-button>
        </el-form-item>
      </el-form>
    </el-card>
    
    <!-- æ•°æ®è¡¨æ ¼ -->
    <el-card class="table-card">
      <el-table :data="tableData" v-loading="loading" border>
        <el-table-column prop="id" label="ID" width="80" />
        <el-table-column prop="title" label="é—®é¢˜æ ‡é¢˜" min-width="200" show-overflow-tooltip />
        <el-table-column prop="categoryName" label="åˆ†ç±»" width="120" />
        <el-table-column prop="departmentName" label="æ‰€å±éƒ¨é—¨" width="120" />
        <el-table-column prop="status" label="çŠ¶æ€" width="100">
          <template #default="{ row }">
            <el-tag :type="getStatusType(row.status)">{{ getStatusText(row.status) }}</el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="isHot" label="çƒ­ç‚¹" width="80">
          <template #default="{ row }">
            <el-tag v-if="row.isHot" type="danger">çƒ­ç‚¹</el-tag>
            <span v-else>-</span>
          </template>
        </el-table-column>
        <el-table-column prop="clickCount" label="ç‚¹å‡»é‡" width="100" sortable />
        <el-table-column prop="updateTime" label="æ›´æ–°æ—¶é—´" width="180" />
        <el-table-column label="æ“ä½œ" width="200" fixed="right">
          <template #default="{ row }">
            <el-button type="primary" link @click="handleEdit(row)" v-permission="'QA:UPDATE'">
              ç¼–è¾‘
            </el-button>
            <el-button type="danger" link @click="handleDelete(row)" v-permission="'QA:DELETE'">
              åˆ é™¤
            </el-button>
            <el-button 
              v-if="row.status === 2" 
              type="warning" 
              link 
              @click="toggleHot(row)"
              v-permission="'QA:HOT'"
            >
              {{ row.isHot ? 'å–æ¶ˆçƒ­ç‚¹' : 'è®¾ä¸ºçƒ­ç‚¹' }}
            </el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <!-- åˆ†é¡µ -->
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handlePageChange"
      />
    </el-card>
    
    <!-- æ–°å¢/ç¼–è¾‘å¼¹çª— -->
    <qa-edit-dialog 
      v-model:visible="dialogVisible"
      :edit-data="currentEdit"
      @success="handleSearch"
    />
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { ElMessage, ElMessageBox } from 'element-plus';
import { useQaStore } from '@/stores/qa';
import QaEditDialog from './components/QaEditDialog.vue';

const qaStore = useQaStore();

const searchForm = reactive({
  keyword: '',
  categoryId: null,
  status: null
});

const tableData = ref([]);
const loading = ref(false);
const pagination = reactive({
  page: 1,
  size: 10,
  total: 0
});

const categories = ref([]);
const dialogVisible = ref(false);
const currentEdit = ref(null);

// çŠ¶æ€æ˜ å°„ï¼ˆå¯¹åº”æ–‡æ¡£2çŠ¶æ€æœºï¼‰
const statusMap = {
  0: { text: 'è‰ç¨¿', type: 'info' },
  1: { text: 'å¾…å®¡æ ¸', type: 'warning' },
  2: { text: 'å·²å‘å¸ƒ', type: 'success' },
  3: { text: 'å·²é©³å›', type: 'danger' }
};

const getStatusText = (status) => statusMap[status]?.text || 'æœªçŸ¥';
const getStatusType = (status) => statusMap[status]?.type || 'info';

onMounted(() => {
  loadCategories();
  handleSearch();
});

const loadCategories = async () => {
  categories.value = await qaStore.getCategories();
};

const handleSearch = async () => {
  loading.value = true;
  try {
    const res = await qaStore.searchQa({
      ...searchForm,
      page: pagination.page,
      size: pagination.size
    });
    tableData.value = res.list;
    pagination.total = res.total;
  } finally {
    loading.value = false;
  }
};

const resetSearch = () => {
  Object.keys(searchForm).forEach(key => {
    searchForm[key] = key === 'keyword' ? '' : null;
  });
  pagination.page = 1;
  handleSearch();
};

const handleAdd = () => {
  currentEdit.value = null;
  dialogVisible.value = true;
};

const handleEdit = (row) => {
  currentEdit.value = row;
  dialogVisible.value = true;
};

const handleDelete = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®è®¤åˆ é™¤è¯¥é—®ç­”ï¼Ÿ', 'æç¤º', { type: 'warning' });
    await qaStore.deleteQa(row.id);
    ElMessage.success('åˆ é™¤æˆåŠŸ');
    handleSearch();
  } catch {
    // å–æ¶ˆåˆ é™¤
  }
};

const toggleHot = async (row) => {
  await qaStore.setHotStatus(row.id, !row.isHot);
  ElMessage.success(row.isHot ? 'å·²å–æ¶ˆçƒ­ç‚¹' : 'å·²è®¾ä¸ºçƒ­ç‚¹');
  handleSearch();
};

const handleSizeChange = (size) => {
  pagination.size = size;
  handleSearch();
};

const handlePageChange = (page) => {
  pagination.page = page;
  handleSearch();
};
</script>
```

#### 4.2.2 é€šçŸ¥å‘å¸ƒï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘ + èŒƒå›´æ§åˆ¶ï¼‰

**src/views/notice/NoticePublish.vue**ï¼š
```vue
<template>
  <div class="notice-publish">
    <el-card>
      <el-form :model="form" :rules="rules" ref="formRef" label-width="100px">
        <el-form-item label="é€šçŸ¥æ ‡é¢˜" prop="title">
          <el-input v-model="form.title" maxlength="100" show-word-limit />
        </el-form-item>
        
        <el-form-item label="æ‰€å±éƒ¨é—¨" prop="departmentId">
          <el-select v-model="form.departmentId" disabled>
            <el-option :label="userDeptName" :value="userDeptId" />
          </el-select>
          <span class="tip">è‡ªåŠ¨å…³è”æ‚¨çš„æ‰€å±éƒ¨é—¨</span>
        </el-form-item>
        
        <el-form-item label="ç´§æ€¥ç¨‹åº¦" prop="urgencyLevel">
          <el-radio-group v-model="form.urgencyLevel">
            <el-radio-button :label="0">æ™®é€š</el-radio-button>
            <el-radio-button :label="1">é‡è¦</el-radio-button>
            <el-radio-button :label="2">ç´§æ€¥</el-radio-button>
          </el-radio-group>
        </el-form-item>
        
        <el-form-item label="å¯è§èŒƒå›´" prop="visibilityType">
          <el-radio-group v-model="form.visibilityType">
            <el-radio-button :label="0">å…¨æ ¡å¯è§</el-radio-button>
            <el-radio-button :label="1">æŒ‡å®šå­¦é™¢</el-radio-button>
            <el-radio-button :label="2">æŒ‡å®šå¹´çº§</el-radio-button>
            <el-radio-button :label="3">æŒ‡å®šä¸“ä¸š</el-radio-button>
          </el-radio-group>
        </el-form-item>
        
        <!-- æ¡ä»¶æ˜¾ç¤ºèŒƒå›´é€‰æ‹© -->
        <el-form-item v-if="form.visibilityType === 1" label="ç›®æ ‡å­¦é™¢">
          <el-select v-model="form.targetCollegeId" placeholder="è¯·é€‰æ‹©">
            <el-option 
              v-for="college in colleges" 
              :key="college.id" 
              :label="college.name" 
              :value="college.id" 
            />
          </el-select>
        </el-form-item>
        
        <el-form-item v-if="form.visibilityType === 2" label="ç›®æ ‡å¹´çº§">
          <el-select v-model="form.targetGrade" placeholder="è¯·é€‰æ‹©">
            <el-option 
              v-for="grade in grades" 
              :key="grade" 
              :label="grade + 'çº§'" 
              :value="grade" 
            />
          </el-select>
        </el-form-item>
        
        <el-form-item label="é€šçŸ¥å†…å®¹" prop="content">
          <rich-editor v-model="form.content" height="400px" />
        </el-form-item>
        
        <el-form-item label="é™„ä»¶">
          <el-upload
            action="/api/file/upload"
            :headers="{ Authorization: 'Bearer ' + token }"
            :on-success="handleUploadSuccess"
            :file-list="fileList"
          >
            <el-button type="primary">ä¸Šä¼ é™„ä»¶</el-button>
          </el-upload>
        </el-form-item>
        
        <el-form-item>
          <el-button type="primary" @click="submitPublish" :loading="publishing">
            ç«‹å³å‘å¸ƒ
          </el-button>
          <el-button @click="saveDraft" :loading="saving">
            ä¿å­˜è‰ç¨¿
          </el-button>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';
import { useUserStore } from '@/stores/user';
import { useNoticeStore } from '@/stores/notice';
import RichEditor from '@/components/RichEditor.vue';

const userStore = useUserStore();
const noticeStore = useNoticeStore();

const formRef = ref();
const form = reactive({
  title: '',
  departmentId: userStore.userInfo.departmentId,
  urgencyLevel: 0,
  visibilityType: 0,
  targetCollegeId: null,
  targetGrade: null,
  targetMajor: null,
  content: '',
  attachments: []
});

const rules = {
  title: [{ required: true, message: 'è¯·è¾“å…¥æ ‡é¢˜', trigger: 'blur' }],
  content: [{ required: true, message: 'è¯·è¾“å…¥å†…å®¹', trigger: 'blur' }]
};

const userDeptName = userStore.userInfo.departmentName;
const userDeptId = userStore.userInfo.departmentId;
const token = userStore.token;
const fileList = ref([]);
const publishing = ref(false);
const saving = ref(false);

const handleUploadSuccess = (res) => {
  form.attachments.push(res.data.url);
};

const submitPublish = async () => {
  const valid = await formRef.value.validate();
  if (!valid) return;
  
  publishing.value = true;
  try {
    await noticeStore.publish({
      ...form,
      status: 1 // ç›´æ¥å‘å¸ƒ
    });
    ElMessage.success('å‘å¸ƒæˆåŠŸ');
    // æ¸…ç©ºè¡¨å•
    formRef.value.resetFields();
  } finally {
    publishing.value = false;
  }
};

const saveDraft = async () => {
  saving.value = true;
  try {
    await noticeStore.saveDraft(form);
    ElMessage.success('è‰ç¨¿ä¿å­˜æˆåŠŸ');
  } finally {
    saving.value = false;
  }
};
</script>
```

### 4.3 æƒé™æŒ‡ä»¤ä¸è·¯ç”±å®ˆå«

**src/directives/permission.js**ï¼š
```javascript
import { useUserStore } from '@/stores/user';

export const vPermission = {
  mounted(el, binding) {
    const { value } = binding;
    const userStore = useUserStore();
    
    const hasPermission = userStore.permissions.includes(value);
    if (!hasPermission) {
      el.remove(); // æ— æƒé™ç›´æ¥ç§»é™¤DOM
    }
  }
};
```

**src/router/guards.js**ï¼š
```javascript
import { useUserStore } from '@/stores/user';

export function setupRouterGuards(router) {
  router.beforeEach((to, from, next) => {
    const userStore = useUserStore();
    
    // éœ€è¦ç™»å½•
    if (to.meta.requiresAuth && !userStore.token) {
      next('/login');
      return;
    }
    
    // éœ€è¦æƒé™
    if (to.meta.permission && !userStore.permissions.includes(to.meta.permission)) {
      next('/403');
      return;
    }
    
    next();
  });
}
```

---

## ç¬¬5ç«  å¼€å‘è‡ªæ£€æ¸…å•ï¼ˆChecklistï¼‰

### 5.1 åç«¯æ£€æŸ¥æ¸…å•ï¼ˆæäº¤å‰å¿…åšï¼‰

| æ£€æŸ¥é¡¹          | æ£€æŸ¥å‘½ä»¤/æ–¹æ³•                                          | é€šè¿‡æ ‡å‡†                     |
| :-------------- | :----------------------------------------------------- | :--------------------------- |
| XMLæ— æœªè½¬ä¹‰ç¬¦å· | `rg -n "where.*<[^!]" src/main/resources/mapper/*.xml` | æ— è¾“å‡º                       |
| å…¨æ–‡æ£€ç´¢SQLæ­£ç¡® | æ£€æŸ¥`MATCH...AGAINST`è¯­æ³•                              | ä½¿ç”¨CDATAåŒ…è£¹                |
| å¾®ä¿¡é…ç½®å®‰å…¨    | æ£€æŸ¥`application.yml`                                  | appid/secretä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  |
| JWTå¯†é’¥å¼ºåº¦     | æ£€æŸ¥`jwt.secret`                                       | é•¿åº¦â‰¥32ä½éšæœºå­—ç¬¦ä¸²          |
| æ•æ„Ÿè¯è¿‡æ»¤      | æ£€æŸ¥`SensitiveWordFilter`                              | æ‰€æœ‰å‘å¸ƒå†…å®¹ç»è¿‡æ»¤           |
| æ¥å£æœ‰æƒé™æ³¨è§£  | æ£€æŸ¥`@PreAuthorize`è¦†ç›–ç‡                              | 100%è¦†ç›–ï¼ˆé™¤ç™»å½•æ¥å£ï¼‰       |

### 5.2 å¾®ä¿¡å°ç¨‹åºæ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹            | æ£€æŸ¥æ–¹æ³•                | é€šè¿‡æ ‡å‡†                         |
| :---------------- | :---------------------- | :------------------------------- |
| ç™»å½•æ€ç®¡ç†        | æµ‹è¯•tokenè¿‡æœŸåœºæ™¯       | è‡ªåŠ¨è·³è½¬ç™»å½•é¡µï¼Œç»­æœŸåè¿”å›åŸé¡µé¢ |
| æœç´¢å†å²æœ¬åœ°å­˜å‚¨  | æ£€æŸ¥`wx.setStorage`ä½¿ç”¨ | æœ€å¤šä¿å­˜10æ¡ï¼Œå»é‡               |
| å¯Œæ–‡æœ¬æ¸²æŸ“å®‰å…¨    | æ£€æŸ¥`rich-text`ç»„ä»¶     | è¿‡æ»¤å±é™©æ ‡ç­¾ï¼ˆscriptç­‰ï¼‰         |
| è®¢é˜…æ¶ˆæ¯æˆæƒ      | æµ‹è¯•è®¢é˜…æµç¨‹            | ç¬¦åˆå¾®ä¿¡å°ç¨‹åºè®¢é˜…è§„èŒƒ           |
| ä¸‹æ‹‰åˆ·æ–°/ä¸Šæ‹‰åŠ è½½ | æµ‹è¯•åˆ—è¡¨é¡µ              | æœ‰loadingçŠ¶æ€ï¼Œæ— é‡å¤è¯·æ±‚        |
| åˆ†äº«åŠŸèƒ½          | æµ‹è¯•`onShareAppMessage` | æ¯ä¸ªé¡µé¢å¯åˆ†äº«ï¼Œå¸¦å‚æ•°           |

### 5.3 ç®¡ç†åå°æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹       | æ£€æŸ¥æ–¹æ³•                   | é€šè¿‡æ ‡å‡†                      |
| :----------- | :------------------------- | :---------------------------- |
| æƒé™æŒ‡ä»¤ç”Ÿæ•ˆ | æµ‹è¯•æ— æƒé™ç”¨æˆ·è®¿é—®         | æ— æƒé™æŒ‰é’®ä¸æ˜¾ç¤ºï¼Œæ¥å£è¿”å›403 |
| å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ | æµ‹è¯•XSSè¾“å…¥                | è„šæœ¬æ ‡ç­¾è¢«è¿‡æ»¤                |
| è¡¨å•éªŒè¯     | æµ‹è¯•ç©ºå€¼/è¶…é•¿è¾“å…¥          | å‰ç«¯+åç«¯åŒé‡éªŒè¯             |
| æ•°æ®æƒé™     | æµ‹è¯•ä¿¡æ¯å‘˜Açœ‹ä¿¡æ¯å‘˜Bçš„æ•°æ® | åªèƒ½çœ‹åˆ°è‡ªå·±éƒ¨é—¨çš„æ•°æ®        |
| æ“ä½œæ—¥å¿—     | æ£€æŸ¥æ•°æ®åº“`operation_log`  | æ‰€æœ‰æ•æ„Ÿæ“ä½œæœ‰è®°å½•            |

---

## é™„å½•ï¼šä¸ä»»åŠ¡ä¹¦åŠŸèƒ½å¯¹ç…§è¡¨

| ä»»åŠ¡ä¹¦åŠŸèƒ½æ¨¡å—              | æœ¬æ–‡æ¡£å¯¹åº”ç« èŠ‚      | æ ¸å¿ƒä»£ç æ–‡ä»¶                                     |
| :-------------------------- | :------------------ | :----------------------------------------------- |
| **æ™ºèƒ½é—®ç­”æ ¸å¿ƒ**            |                     |                                                  |
| å¤šæ¨¡å¼æé—®ï¼ˆå…³é”®è¯/åˆ†ç±»æ ‘ï¼‰ | 3.2.1, 3.2.2        | `pages/index/index.js`, `pages/search/search.js` |
| æ™ºèƒ½è”æƒ³ä¸æ’åº              | 2.2.1               | `QaServiceImpl.search()`                         |
| è‡ªç„¶è¯­è¨€æ„å›¾è¯†åˆ«            | 2.2.1               | `recognizeIntent()`æ–¹æ³•                          |
| **æ ¡å›­ä¿¡æ¯èšåˆ**            |                     |                                                  |
| é€šçŸ¥å…¬å‘Šå¢™                  | 3.2.1ï¼ˆä¸ªæ€§åŒ–æ¨èï¼‰ | `noticeService.getPersonalized()`                |
| è®¢é˜…ä¸æ¨é€                  | 2.2.3               | `NoticeServiceImpl.pushToSubscribers()`          |
| **ä¸ªæ€§åŒ–æœåŠ¡**              |                     |                                                  |
| ä¸ªäººæ”¶è—ä¸å†å²              | 3.2.1               | `loadSearchHistory()`                            |
| åŸºäºèº«ä»½çš„ä¿¡æ¯ç­›é€‰          | 2.2.2, 3.2.1        | `getPersonalizedNotices()`                       |
| **è½»é‡äº‹åŠ¡æŒ‡å¼•**            |                     |                                                  |
| åŠäº‹æŒ‡å—                    | 3.2.2ï¼ˆç©ºçŠ¶æ€è·³è½¬ï¼‰ | `goToGuide()`                                    |
| **åå°ç®¡ç†**                |                     |                                                  |
| é—®ç­”çŸ¥è¯†åº“ç®¡ç†              | 4.2.1               | `QaManagement.vue`                               |
| çƒ­ç‚¹é—®é¢˜æ ‡æ³¨                | 4.2.1               | `toggleHot()`æ–¹æ³•                                |
| é€šçŸ¥å‘å¸ƒä¸èŒƒå›´æ§åˆ¶          | 4.2.2               | `NoticePublish.vue`                              |
| ç”¨æˆ·åé¦ˆå¤„ç†                | 3.2.2               | `onFeedback()`æ–¹æ³•                               |
| å¤šè§’è‰²æƒé™ç®¡ç†              | 4.3                 | `vPermission`æŒ‡ä»¤                                |
| æ•°æ®ç»Ÿè®¡                    | 4.2.1ï¼ˆè¡¨æ ¼ç»Ÿè®¡ï¼‰   | `pagination`, `clickCount`æ’åº                   |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**ç¼–å†™æ—¥æœŸ**ï¼š2026å¹´2æœˆ19æ—¥  
**ç¼–å†™äºº**ï¼šå‘¨éœ‡  
**æŒ‡å¯¼æ•™å¸ˆ**ï¼šé‚“å¨œ/å¼ é™ˆæ™¨

æœ¬ã€Šç¼–ç è§„èŒƒä¸å®ç°æ¨¡æ¿ã€‹ä¸ã€Šä»»åŠ¡ä¹¦ã€‹ã€Šå¼€é¢˜æŠ¥å‘Šã€‹é…å¥—ä½¿ç”¨ï¼Œç¡®ä¿æ ¡å›­æ™ºèƒ½é—®ç­”ç³»ç»Ÿå¼€å‘é˜¶æ®µä¸€æ¬¡æˆå‹ã€ç¬¦åˆæ¯•ä¸šè®¾è®¡è¦æ±‚ã€‚